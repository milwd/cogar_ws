

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perception Components &mdash; cogar_ass1 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=f2a433a1"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Reasoning &amp; Planning Components" href="reasoning.html" />
    <link rel="prev" title="Assignment 1 Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            cogar_ass1
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Perception Components</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#camera-py">camera.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#camera-preprocessing-py">camera_preprocessing.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lidar-py">lidar.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sonar-py">sonar.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#object-detection-py">object_detection.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sensor-fusion-py">sensor_fusion.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#distance-estimation-py">distance_estimation.py</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reasoning.html">Reasoning &amp; Planning Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="actuation.html">Actuation &amp; Control Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="interaction.html">Interaction Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="orchestration.html">Orchestration &amp; Management</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cogar_ass1</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Perception Components</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/perception.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-camera">
<span id="perception-components"></span><h1>Perception Components<a class="headerlink" href="#module-camera" title="Link to this heading"></a></h1>
<section id="camera-py">
<h2>camera.py<a class="headerlink" href="#camera-py" title="Link to this heading"></a></h2>
<section id="synthetic-rgb-depth-sensor-for-rapid-dependency-free-testing">
<h3>Synthetic <strong>RGB + Depth</strong> sensor for rapid, dependency-free testing<a class="headerlink" href="#synthetic-rgb-depth-sensor-for-rapid-dependency-free-testing" title="Link to this heading"></a></h3>
<p>This script pretends to be a camera node even when no real hardware is
attached.  It continuously publishes <strong>one static RGB frame</strong> together with a
<strong>mock depth map</strong> so that downstream perception, fusion or visualisation
nodes can start development immediately.</p>
<dl class="simple">
<dt>Why a dummy camera?</dt><dd><ul class="simple">
<li><p><em>Deterministic output</em> – unit tests and integration pipelines do not rely
on external devices or recorded ROS bags.</p></li>
<li><p><em>Speed</em> – a single JPEG on disk avoids the overhead of connecting to
physical sensors.</p></li>
<li><p><em>Isolation</em> – failures in consumer nodes are never due to flaky hardware.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="published-topics">
<h3>Published topics<a class="headerlink" href="#published-topics" title="Link to this heading"></a></h3>
<p>Both messages share <em>wall-clock</em> time stamps and are published at <strong>10 Hz</strong> so
that synchronisation filters (e.g. message_filters) treat them as a stereo
pair.</p>
</section>
<section id="directory-layout">
<h3>Directory layout<a class="headerlink" href="#directory-layout" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">camera.py</span></code> expects the JPEG at
<code class="docutils literal notranslate"><span class="pre">/root/Desktop/cogar_ass1/cogar_ws/src/tiago1/scripts/image.jpg</span></code>.
Change the path if you move the file; no other configuration is required.</p>
</section>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="camera.publish">
<span class="sig-prename descclassname"><span class="pre">camera.</span></span><span class="sig-name descname"><span class="pre">publish</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/camera.html#publish"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#camera.publish" title="Link to this definition"></a></dt>
<dd><p>Bootstrap the node and stream frames until ROS shuts down.</p>
<section id="execution-flow">
<h2>Execution flow<a class="headerlink" href="#execution-flow" title="Link to this heading"></a></h2>
<p>1. <strong>Node init</strong>
– registers the process with the ROS master under the name <code class="docutils literal notranslate"><span class="pre">camera</span></code>.</p>
<ol class="arabic simple" start="2">
<li><p><strong>Publisher creation</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pub_rgb</span></code>  → <code class="docutils literal notranslate"><span class="pre">/camera</span></code>  (BGR colour image)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pub_depth</span></code> → <code class="docutils literal notranslate"><span class="pre">/depth</span></code>   (8-bit signed mono depth)</p></li>
</ul>
</li>
<li><p><strong>Main loop</strong> (10 Hz):</p>
<ol class="loweralpha simple">
<li><p>Read the <em>unchanging</em> JPEG from disk.
Reading from disk each cycle guarantees that edits to the file show up
immediately, handy for quick visual experiments.</p></li>
<li><p>Convert the NumPy array to <code class="docutils literal notranslate"><span class="pre">sensor_msgs/Image</span></code> via <strong>cv_bridge</strong>.</p></li>
<li><p>Publish the RGB frame.</p></li>
<li><p>Allocate a depth array of identical resolution, fill it with ones
(1 m in whatever synthetic unit you prefer), convert and publish.</p></li>
<li><p>Sleep the remaining time to keep the loop period at ~100 ms.</p></li>
</ol>
</li>
<li><p>On shutdown (Ctrl-C or <code class="docutils literal notranslate"><span class="pre">rosnode</span> <span class="pre">kill</span></code>) the <code class="docutils literal notranslate"><span class="pre">rospy.is_shutdown()</span></code>
flag becomes <em>True</em> and the while-loop exits cleanly.</p></li>
</ol>
</section>
<section id="exceptions">
<h2>Exceptions<a class="headerlink" href="#exceptions" title="Link to this heading"></a></h2>
<p>Any exception raised inside the loop will abort the node unless you wrap
the offending code in additional <code class="docutils literal notranslate"><span class="pre">try/except</span></code> blocks.  ROS-level
interruptions (e.g. lost master) are already handled in <code class="docutils literal notranslate"><span class="pre">main</span></code>.</p>
</section>
</dd></dl>

<section id="camera-preprocessing-py">
<span id="module-camera_preprocessing"></span><h2>camera_preprocessing.py<a class="headerlink" href="#camera-preprocessing-py" title="Link to this heading"></a></h2>
<p>Real-time image <em>sanitiser</em> that sits between the raw camera node and higher-level
perception modules.  It consumes <strong>unprocessed RGB + Depth streams</strong> and
publishes <em>cleaned</em> versions with reduced noise, corrected illumination and
normalised depth values.</p>
<dl class="simple">
<dt>Why preprocess?</dt><dd><ul class="simple">
<li><p><em>Noise robustness</em> – downstream CNNs and classical detectors converge
faster on well-behaved input.</p></li>
<li><p><em>Bandwidth reduction</em> – optional resizing or compression can be added
here without touching consumer nodes.</p></li>
<li><p><em>Separation of concerns</em> – hardware quirks are handled once in this node
instead of scattered across the codebase.</p></li>
</ul>
</dd>
</dl>
<section id="topic-contracts">
<h3>Topic contracts<a class="headerlink" href="#topic-contracts" title="Link to this heading"></a></h3>
<p>All processed messages retain the <strong>original header stamps</strong> so that time-based
synchronisation in later stages remains intact.</p>
</section>
<section id="node-life-cycle">
<h3>Node life-cycle<a class="headerlink" href="#node-life-cycle" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Initialise <code class="docutils literal notranslate"><span class="pre">rospy</span></code> under the name <strong>camera_preprocessing_node</strong>.</p></li>
<li><p>Instantiate a single <strong>CvBridge</strong> (expensive to create, cheap to reuse).</p></li>
<li><p>Subscribe to raw RGB and depth topics.</p></li>
<li><p>Advertise the corresponding “<a href="#id1"><span class="problematic" id="id2">*</span></a>_processed” topics.</p></li>
<li><p>Process images inside the two callbacks; no polling loop is needed.</p></li>
<li><p>Keep spinning until ROS shutdown or user interruption.</p></li>
</ol>
</section>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="camera_preprocessing.CameraPreprocessing">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">camera_preprocessing.</span></span><span class="sig-name descname"><span class="pre">CameraPreprocessing</span></span><a class="reference internal" href="_modules/camera_preprocessing.html#CameraPreprocessing"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#camera_preprocessing.CameraPreprocessing" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Perform in-place enhancement of RGB and depth streams.</p>
<section id="variables">
<h2>Variables<a class="headerlink" href="#variables" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>bridge<span class="classifier">cv_bridge.CvBridge</span></dt><dd><p>Zero-copy converter between <code class="docutils literal notranslate"><span class="pre">sensor_msgs/Image</span></code> and <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>.</p>
</dd>
<dt>rgb_sub<span class="classifier">rospy.Subscriber</span></dt><dd><p>Subscribes to the raw RGB frames on <code class="docutils literal notranslate"><span class="pre">/camera</span></code>.</p>
</dd>
<dt>depth_sub<span class="classifier">rospy.Subscriber</span></dt><dd><p>Subscribes to the raw depth frames on <code class="docutils literal notranslate"><span class="pre">/depth</span></code>.</p>
</dd>
<dt>rgb_pub<span class="classifier">rospy.Publisher</span></dt><dd><p>Publishes cleaned RGB frames on <code class="docutils literal notranslate"><span class="pre">/camera_processed</span></code>.</p>
</dd>
<dt>depth_pub<span class="classifier">rospy.Publisher</span></dt><dd><p>Publishes cleaned depth maps on <code class="docutils literal notranslate"><span class="pre">/depth_processed</span></code>.</p>
</dd>
</dl>
<p>Register the node, wire the pubs/subs and leave the callbacks running.</p>
<p>No explicit main loop is necessary; <code class="docutils literal notranslate"><span class="pre">rospy.spin()</span></code> in <em>main</em> keeps the
process alive and dispatches incoming messages to the callbacks.</p>
<dl class="py method">
<dt class="sig sig-object py" id="camera_preprocessing.CameraPreprocessing.depth_callback">
<span class="sig-name descname"><span class="pre">depth_callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">sensor_msgs.msg.Image</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="_modules/camera_preprocessing.html#CameraPreprocessing.depth_callback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#camera_preprocessing.CameraPreprocessing.depth_callback" title="Link to this definition"></a></dt>
<dd><p>Clean up a depth map and re-emit it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>msg</strong> (<em>sensor_msgs.msg.Image</em>) – Raw depth map from <code class="docutils literal notranslate"><span class="pre">/depth</span></code> (encoding is passed through).</p>
</dd>
</dl>
<section id="workflow">
<h3>Workflow<a class="headerlink" href="#workflow" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Convert to <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> without altering the encoding.</p></li>
<li><p>Apply a simple <em>lower threshold</em> – any depth below 0.5 m is set to 0,
everything else is kept (acts as a near-clipping plane).</p></li>
<li><p>Convert back to ROS <code class="docutils literal notranslate"><span class="pre">Image</span></code> and copy the header.</p></li>
<li><p>Publish to <code class="docutils literal notranslate"><span class="pre">/depth_processed</span></code>.</p></li>
</ol>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="camera_preprocessing.CameraPreprocessing.rgb_callback">
<span class="sig-name descname"><span class="pre">rgb_callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">sensor_msgs.msg.Image</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="_modules/camera_preprocessing.html#CameraPreprocessing.rgb_callback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#camera_preprocessing.CameraPreprocessing.rgb_callback" title="Link to this definition"></a></dt>
<dd><p>Denoise and forward an RGB frame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>msg</strong> (<em>sensor_msgs.msg.Image</em>) – Raw BGR frame from <code class="docutils literal notranslate"><span class="pre">/camera</span></code>.</p>
</dd>
</dl>
<section id="id3">
<h3>Workflow<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Convert to <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> using <strong>cv_bridge</strong>.</p></li>
<li><p>Apply a <em>Gaussian blur</em> (remove salt-and-pepper noise).</p></li>
<li><p>Convert back to ROS <code class="docutils literal notranslate"><span class="pre">Image</span></code>.</p></li>
<li><p>Copy the <em>header</em> from the incoming message so that timestamps and
frame IDs stay consistent.</p></li>
<li><p>Publish to <code class="docutils literal notranslate"><span class="pre">/camera_processed</span></code>.</p></li>
</ol>
</section>
</dd></dl>

</section>
</dd></dl>

<section id="lidar-py">
<span id="module-lidar"></span><h2>lidar.py<a class="headerlink" href="#lidar-py" title="Link to this heading"></a></h2>
<section id="synthetic-2-d-lidar-publisher-for-bench-testing-navigation-stacks">
<h3>Synthetic <strong>2-D LiDAR</strong> publisher for bench-testing navigation stacks<a class="headerlink" href="#synthetic-2-d-lidar-publisher-for-bench-testing-navigation-stacks" title="Link to this heading"></a></h3>
<p>This node emulates a planar laser scanner so that path-planning, SLAM or
obstacle-avoidance components can be developed on a laptop without any real
sensor or recorded bags.</p>
</section>
<section id="published-topic">
<h3>Published topic<a class="headerlink" href="#published-topic" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">/lidar</span></code>  ( <code class="docutils literal notranslate"><span class="pre">sensor_msgs/LaserScan</span></code> )   10 Hz, 180 beams</p>
<section id="message-layout">
<h4>Message layout<a class="headerlink" href="#message-layout" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Field</p></td>
<td><p>Value</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">header.frame_id</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;laser&quot;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">angle_min</span></code></p></td>
<td><p>–π / 2 rad   (–90 °)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">angle_max</span></code></p></td>
<td><p>+π / 2 rad   (+90 °)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">angle_increment</span></code></p></td>
<td><p>π / 180 rad  (1 ° per beam)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">time_increment</span></code></p></td>
<td><p>0 s (all beams considered simultaneous)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">range_min</span></code></p></td>
<td><p>0.1 m  (typical safety threshold)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">range_max</span></code></p></td>
<td><p>10.0 m</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ranges</span></code></p></td>
<td><p>181 floats, each <strong>5.0 m</strong></p></td>
</tr>
</tbody>
</table>
<p>Change any of the numeric constants to mimic a different sensor model.</p>
</section>
</section>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="lidar.publish">
<span class="sig-prename descclassname"><span class="pre">lidar.</span></span><span class="sig-name descname"><span class="pre">publish</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lidar.html#publish"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lidar.publish" title="Link to this definition"></a></dt>
<dd><p>Continuously construct and transmit <strong>LaserScan</strong> messages.</p>
<section id="id4">
<h2>Workflow<a class="headerlink" href="#id4" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Initialise ROS</strong> under the name <code class="docutils literal notranslate"><span class="pre">lidar_node</span></code> (anonymous to allow
multiple instances).</p></li>
<li><p><strong>Advertise</strong> the <code class="docutils literal notranslate"><span class="pre">/lidar</span></code> topic.</p></li>
<li><p>Enter a <strong>10 Hz loop</strong> that:</p>
<ol class="loweralpha simple">
<li><p>Allocates a fresh <code class="docutils literal notranslate"><span class="pre">LaserScan</span></code> instance.</p></li>
<li><p>Fills the <a href="#id5"><span class="problematic" id="id6">:pyattr:`~sensor_msgs.msg.LaserScan.header`</span></a> with the
current time stamp and the fixed frame <code class="docutils literal notranslate"><span class="pre">&quot;laser&quot;</span></code>.</p></li>
<li><p>Sets angular limits and increment so that the scan spans 180 degrees
with 1-degree resolution.</p></li>
<li><p>Populates <a href="#id7"><span class="problematic" id="id8">:pyattr:`~sensor_msgs.msg.LaserScan.ranges`</span></a> with a constant
distance (<em>5 m</em> in this example).</p></li>
<li><p>Publishes the message.</p></li>
<li><p>Sleeps the remaining time to honour the 10 Hz rate.</p></li>
</ol>
</li>
</ol>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">time_increment</span></code> is left at 0 because the entire fake scan is assumed
to be captured instantaneously.</p></li>
<li><p>Replace the constant list comprehension with any custom profile
(e.g. walls, obstacles) if you need more realistic testing stimuli.</p></li>
</ul>
</section>
</dd></dl>

<section id="sonar-py">
<span id="module-sonar"></span><h2>sonar.py<a class="headerlink" href="#sonar-py" title="Link to this heading"></a></h2>
<section id="synthetic-ultrasound-range-finder-for-quick-sensor-fusion-prototyping">
<h3>Synthetic <strong>ultrasound range-finder</strong> for quick sensor-fusion prototyping<a class="headerlink" href="#synthetic-ultrasound-range-finder-for-quick-sensor-fusion-prototyping" title="Link to this heading"></a></h3>
<p>This node mimics a 1-D sonar module by broadcasting a constant
<a href="#id9"><span class="problematic" id="id10">:pyclass:`sensor_msgs.msg.Range`</span></a> message.  Navigation, fusion and obstacle
avoidance stacks can therefore be exercised on any machine—even one with no
hardware attached or ROS bag available.</p>
</section>
<section id="id11">
<h3>Published topic<a class="headerlink" href="#id11" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">/sonar</span></code> ( <code class="docutils literal notranslate"><span class="pre">sensor_msgs/Range</span></code> ) 10 Hz, single beam</p>
<section id="id12">
<h4>Message layout<a class="headerlink" href="#id12" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Field</p></td>
<td><p>Value</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">header.frame_id</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;sonar&quot;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">radiation_type</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Range.ULTRASOUND</span></code>  (numeric constant 0)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">field_of_view</span></code></p></td>
<td><p>0.1 rad ≈ 5.7 °</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">min_range</span></code></p></td>
<td><p>0.2 m</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">max_range</span></code></p></td>
<td><p>4.0 m</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">range</span></code></p></td>
<td><p><strong>3.0 m</strong> (fixed reading)</p></td>
</tr>
</tbody>
</table>
<p>Tweak any constant to emulate a different device or scenario.</p>
</section>
</section>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="sonar.publish">
<span class="sig-prename descclassname"><span class="pre">sonar.</span></span><span class="sig-name descname"><span class="pre">publish</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="_modules/sonar.html#publish"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sonar.publish" title="Link to this definition"></a></dt>
<dd><p>Spawn the node and stream <strong>Range</strong> messages until ROS shuts down.</p>
<section id="id13">
<h2>Workflow<a class="headerlink" href="#id13" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Advertise</strong> the <code class="docutils literal notranslate"><span class="pre">/sonar</span></code> topic (queue size 10).</p></li>
<li><p><strong>Initialise</strong> the node with the name <code class="docutils literal notranslate"><span class="pre">sonar_node</span></code>; <code class="docutils literal notranslate"><span class="pre">anonymous=True</span></code>
allows multiple dummy sonars to coexist.</p></li>
<li><p>Enter a <strong>10 Hz loop</strong> that:</p>
<ol class="loweralpha simple">
<li><p>Instantiates <a href="#id14"><span class="problematic" id="id15">:pyclass:`sensor_msgs.msg.Range`</span></a>.</p></li>
<li><p>Fills <a href="#id16"><span class="problematic" id="id17">:pyattr:`~sensor_msgs.msg.Range.header`</span></a> with <em>now()</em> and
<code class="docutils literal notranslate"><span class="pre">&quot;sonar&quot;</span></code> as the frame.</p></li>
<li><p>Sets <a href="#id18"><span class="problematic" id="id19">:pyattr:`~sensor_msgs.msg.Range.radiation_type`</span></a> to
<code class="docutils literal notranslate"><span class="pre">Range.ULTRASOUND</span></code>.</p></li>
<li><p>Assigns field-of-view and valid range limits.</p></li>
<li><p>Stores the constant distance <em>3 m</em> in <a href="#id20"><span class="problematic" id="id21">:pyattr:`~sensor_msgs.msg.Range.range`</span></a>.</p></li>
<li><p>Publishes the message.</p></li>
<li><p>Sleeps the remaining time to keep the period at 100 ms.</p></li>
</ol>
</li>
</ol>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Replace the single constant with a random value or scripted profile to
create more realistic test stimuli.</p></li>
</ul>
</section>
</dd></dl>

<section id="object-detection-py">
<span id="module-object_detection"></span><h2>object_detection.py<a class="headerlink" href="#object-detection-py" title="Link to this heading"></a></h2>
<section id="placeholder-vision-node-that-pretends-to-recognise-objects-in-every-frame">
<h3>Placeholder <strong>vision node</strong> that pretends to recognise objects in every frame<a class="headerlink" href="#placeholder-vision-node-that-pretends-to-recognise-objects-in-every-frame" title="Link to this heading"></a></h3>
<p>The node listens to the <em>already-preprocessed</em> RGB stream and emits a constant
string describing three items.  It runs at <strong>1 Hz</strong>, slow enough to be replaced
later by a real detector running on GPU/CPU accelerators without affecting
subscriber timing.</p>
</section>
<section id="id22">
<h3>Topic contracts<a class="headerlink" href="#id22" title="Link to this heading"></a></h3>
<p>The published text follows the simple format:</p>
<p><code class="docutils literal notranslate"><span class="pre">Detected:</span> <span class="pre">&lt;object1&gt;,</span> <span class="pre">&lt;object2&gt;,</span> <span class="pre">&lt;object3&gt;</span></code></p>
<p>Feel free to replace the hard-coded list or switch to structured messages
(e.g. <code class="docutils literal notranslate"><span class="pre">vision_msgs/Detection2DArray</span></code>) once a real model is available.</p>
</section>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="object_detection.ObjectDetector">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">object_detection.</span></span><span class="sig-name descname"><span class="pre">ObjectDetector</span></span><a class="reference internal" href="_modules/object_detection.html#ObjectDetector"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#object_detection.ObjectDetector" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Minimal façade around a future object-detection pipeline.</p>
<section id="id23">
<h2>Variables<a class="headerlink" href="#id23" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>image_sub<span class="classifier">rospy.Subscriber</span></dt><dd><p>Receives frames from <code class="docutils literal notranslate"><span class="pre">/camera_preprocessed</span></code>.</p>
</dd>
<dt>detect_pub<span class="classifier">rospy.Publisher</span></dt><dd><p>Emits detection results on <code class="docutils literal notranslate"><span class="pre">/camera_detections</span></code>.</p>
</dd>
</dl>
<p>Register the subscriber and publisher.</p>
<p>No additional state is required because the current implementation
returns a fixed string regardless of the incoming image.</p>
<dl class="py method">
<dt class="sig sig-object py" id="object_detection.ObjectDetector.image_callback">
<span class="sig-name descname"><span class="pre">image_callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">sensor_msgs.msg.Image</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="_modules/object_detection.html#ObjectDetector.image_callback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#object_detection.ObjectDetector.image_callback" title="Link to this definition"></a></dt>
<dd><p>Produce and publish a constant detection result.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>_msg</strong> (<em>sensor_msgs.msg.Image</em>) – Ignored content of the pre-processed frame.</p>
</dd>
</dl>
<section id="id24">
<h3>Workflow<a class="headerlink" href="#id24" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Assemble the string <code class="docutils literal notranslate"><span class="pre">&quot;Detected:</span> <span class="pre">Table,</span> <span class="pre">Plate,</span> <span class="pre">Position&quot;</span></code>.</p></li>
<li><p>Wrap it in <a href="#id25"><span class="problematic" id="id26">:pyclass:`std_msgs.msg.String`</span></a>.</p></li>
<li><p>Publish on <code class="docutils literal notranslate"><span class="pre">/camera_detections</span></code>.</p></li>
</ol>
</section>
</dd></dl>

</section>
</dd></dl>

<section id="sensor-fusion-py">
<span id="module-sensor_fusion"></span><h2>sensor_fusion.py<a class="headerlink" href="#sensor-fusion-py" title="Link to this heading"></a></h2>
<section id="ros-fusion-node-that-combines-planar-lidar-and-single-beam-sonar">
<h3>ROS <strong>fusion node</strong> that combines planar LiDAR and single-beam sonar<a class="headerlink" href="#ros-fusion-node-that-combines-planar-lidar-and-single-beam-sonar" title="Link to this heading"></a></h3>
<p>The node listens to</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/lidar</span></code>   ( <a href="#id27"><span class="problematic" id="id28">:sensor_msgs:`LaserScan`</span></a> )</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/sonar</span></code>  ( <a href="#id29"><span class="problematic" id="id30">:sensor_msgs:`Range`</span></a> — ultrasound )</p></li>
</ul>
<p>and emits a <strong>synthetic, fused scan</strong> on</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/fused_scan</span></code>  ( <a href="#id31"><span class="problematic" id="id32">:sensor_msgs:`LaserScan`</span></a> )</p></li>
</ul>
<p>The fusion strategy is deliberately simple:</p>
<ol class="arabic simple">
<li><p>Convert the sonar’s <em>scalar</em> range into a <strong>pseudo-scan</strong> whose length
matches the LiDAR beam count.</p></li>
<li><p>Insert the sonar reading at the centre index, leave all other values «0».</p></li>
<li><p>Add the two arrays element-wise.</p></li>
</ol>
<p>This yields a quick placeholder that exercises downstream consumers without
complex probabilistic filters.</p>
</section>
<section id="id33">
<h3>Topic contracts<a class="headerlink" href="#id33" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Topic</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Dir.</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/lidar</span></code></p></td>
<td><p>LaserScan</p></td>
<td><p>sub</p></td>
<td><p>180 ° LiDAR produced by <em>lidar.py</em></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/sonar</span></code></p></td>
<td><p>Range</p></td>
<td><p>sub</p></td>
<td><p>1-D ultrasound produced by <em>sonar.py</em></p></td>
</tr>
<tr class="row-even"><td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">/fused_scan</span></code> | LaserScan</p></td>
<td><p>pub</p></td>
<td><p>LiDAR beams + centred sonar reading</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="sensor_fusion.Adapter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sensor_fusion.</span></span><span class="sig-name descname"><span class="pre">Adapter</span></span><a class="reference internal" href="_modules/sensor_fusion.html#Adapter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sensor_fusion.Adapter" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Expand a <em>scalar</em> sonar range into a list matching the LiDAR beam count.</p>
<p>The sonar value is inserted at the <strong>centre index</strong>; all other positions
are filled with zero so that simple addition effectively “embeds” the sonar
reading into the LiDAR fan.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sensor_fusion.SensorFusionNode">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sensor_fusion.</span></span><span class="sig-name descname"><span class="pre">SensorFusionNode</span></span><a class="reference internal" href="_modules/sensor_fusion.html#SensorFusionNode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sensor_fusion.SensorFusionNode" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Merge LiDAR and sonar information into a single <code class="xref py py-class docutils literal notranslate"><span class="pre">LaserScan</span></code>.</p>
<section id="id34">
<h2>Variables<a class="headerlink" href="#id34" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>lidar_sub<span class="classifier">rospy.Subscriber</span></dt><dd><p>Receives scans from <code class="docutils literal notranslate"><span class="pre">/lidar</span></code>.</p>
</dd>
<dt>sonar_sub<span class="classifier">rospy.Subscriber</span></dt><dd><p>Receives ranges from <code class="docutils literal notranslate"><span class="pre">/sonar</span></code>.</p>
</dd>
<dt>pub<span class="classifier">rospy.Publisher</span></dt><dd><p>Emits the fused scan on <code class="docutils literal notranslate"><span class="pre">/fused_scan</span></code>.</p>
</dd>
<dt>lidar_data<span class="classifier">sensor_msgs.msg.LaserScan | None</span></dt><dd><p>Last LiDAR scan received.</p>
</dd>
<dt>sonar_data<span class="classifier">sensor_msgs.msg.Range | None</span></dt><dd><p>Last sonar reading received.</p>
</dd>
<dt>adapted_sonar<span class="classifier">list[float]</span></dt><dd><p>Sonar value replicated into a list matching the LiDAR beam count.</p>
</dd>
</dl>
<p>Register the node, wire subscriptions and publisher and
initialise state containers.</p>
<dl class="py method">
<dt class="sig sig-object py" id="sensor_fusion.SensorFusionNode.lidar_callback">
<span class="sig-name descname"><span class="pre">lidar_callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">sensor_msgs.msg.LaserScan</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="_modules/sensor_fusion.html#SensorFusionNode.lidar_callback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sensor_fusion.SensorFusionNode.lidar_callback" title="Link to this definition"></a></dt>
<dd><p>Store the most recent LiDAR scan.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> (<em>sensor_msgs.msg.LaserScan</em>) – Scan received from <code class="docutils literal notranslate"><span class="pre">/lidar</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sensor_fusion.SensorFusionNode.merge_data">
<span class="sig-name descname"><span class="pre">merge_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/sensor_fusion.html#SensorFusionNode.merge_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sensor_fusion.SensorFusionNode.merge_data" title="Link to this definition"></a></dt>
<dd><p>Combine the LiDAR and adapted sonar arrays element-wise.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">len</span> <span class="pre">==</span> <span class="pre">len(self.lidar_data.ranges)</span></code> – sum of both sensors.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)">list</a>[<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)">float</a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sensor_fusion.SensorFusionNode.publish_fused">
<span class="sig-name descname"><span class="pre">publish_fused</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="_modules/sensor_fusion.html#SensorFusionNode.publish_fused"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sensor_fusion.SensorFusionNode.publish_fused" title="Link to this definition"></a></dt>
<dd><p>Produce and publish a fused <code class="xref py py-class docutils literal notranslate"><span class="pre">LaserScan</span></code> if both inputs are ready.</p>
<section id="id35">
<h3>Workflow<a class="headerlink" href="#id35" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Verify that <strong>both</strong> <code class="docutils literal notranslate"><span class="pre">self.lidar_data</span></code> <em>and</em> <code class="docutils literal notranslate"><span class="pre">self.sonar_data</span></code> are
populated.</p></li>
<li><p>Use <a class="reference internal" href="#sensor_fusion.Adapter" title="sensor_fusion.Adapter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Adapter</span></code></a> to expand the single sonar value into a list
whose length equals the LiDAR beam count.</p></li>
<li><p>Call <a class="reference internal" href="#sensor_fusion.SensorFusionNode.merge_data" title="sensor_fusion.SensorFusionNode.merge_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge_data()</span></code></a> to add the two arrays.</p></li>
<li><p>Populate a fresh <code class="xref py py-class docutils literal notranslate"><span class="pre">LaserScan</span></code>, copy the LiDAR header
(time + frame), insert geometry fields, attach the fused range list
and publish.</p></li>
</ol>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sensor_fusion.SensorFusionNode.sonar_callback">
<span class="sig-name descname"><span class="pre">sonar_callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">sensor_msgs.msg.Range</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="_modules/sensor_fusion.html#SensorFusionNode.sonar_callback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sensor_fusion.SensorFusionNode.sonar_callback" title="Link to this definition"></a></dt>
<dd><p>Store the sonar reading <strong>and</strong> trigger a fusion attempt.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> (<em>sensor_msgs.msg.Range</em>) – Range measurement received from <code class="docutils literal notranslate"><span class="pre">/sonar</span></code>.</p>
</dd>
</dl>
</dd></dl>

</section>
</dd></dl>

<section id="distance-estimation-py">
<span id="module-distance_estimation"></span><h2>distance_estimation.py<a class="headerlink" href="#distance-estimation-py" title="Link to this heading"></a></h2>
<section id="in-1-node-depth-aware-object-localisation-table-state-reasoning">
<h3>3-in-1 node: <strong>depth-aware object localisation + table-state reasoning</strong><a class="headerlink" href="#in-1-node-depth-aware-object-localisation-table-state-reasoning" title="Link to this heading"></a></h3>
<p>The node fuses <em>semantic</em> information from an object-detection topic with
<em>metric</em> data from a depth image to output two things:</p>
<ol class="arabic simple">
<li><p><strong>/object_positions</strong> – a human-readable list of XYZ positions for every
object currently visible to the camera (single string message for easy
logging or GUI display).</p></li>
<li><p><strong>/placement_decision</strong> – a concise keyword that tells the waiter robot
<strong>what to do next at the table</strong> ( <em>PLACE</em> a dish, <em>FULL</em> do nothing,
<em>CLEAR</em> remove crockery, or <em>IGNORE</em>).</p></li>
</ol>
<p>Both decisions are produced via the <strong>Strategy pattern</strong>, so swapping the
business logic requires only instantiating a different strategy class.</p>
<dl>
<dt>Why split placement vs clearing?</dt><dd><ul class="simple">
<li><p>Placement reasoning only cares about <em>free space</em> (≤ 3 items).</p></li>
<li><p>Clearing reasoning only cares about detecting <em>specific</em> objects
(plate + cup).</p></li>
</ul>
<p>Keeping them in separate interchangeable strategies lets you tune or
replace each behaviour independently.</p>
</dd>
</dl>
</section>
<section id="ros-i-o-summary">
<h3>ROS I/O summary<a class="headerlink" href="#ros-i-o-summary" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Direction</p></th>
<th class="head"><p>Topic name / Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Subscribe</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/camera_detections</span></code></p></td>
<td><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">std_msgs/String</span></code> – e.g.</dt><dd><p><code class="docutils literal notranslate"><span class="pre">&quot;Detected:</span> <span class="pre">cup,</span> <span class="pre">plate&quot;</span></code></p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>Subscribe</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/depth_processed</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sensor_msgs/Image</span></code> – 32-bit float</p></td>
</tr>
<tr class="row-even"><td><p>Publish</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/object_positions</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std_msgs/String</span></code> – formatted XYZ list</p></td>
</tr>
<tr class="row-odd"><td><p>Publish</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/placement_decision</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std_msgs/String</span></code> –
<code class="docutils literal notranslate"><span class="pre">&quot;Decision:</span> <span class="pre">PLACE,</span> <span class="pre">CLEAR&quot;</span></code> etc.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="assumptions-limitations">
<h3>Assumptions &amp; Limitations<a class="headerlink" href="#assumptions-limitations" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Exactly one RGB/Depth camera with <strong>pinhole intrinsics</strong> (fx, fy, cx, cy
hard-coded below).</p></li>
<li><p>Only the image-centre pixel is sampled for depth right now – replace that
placeholder with real 2-D bounding-box → 3-D projection for production use.</p></li>
<li><p>Object detection arrives as a simple string; in a real pipeline you would
subscribe to a custom message carrying bounding boxes and class labels.</p></li>
</ul>
</section>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="distance_estimation.ClearingStrategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">distance_estimation.</span></span><span class="sig-name descname"><span class="pre">ClearingStrategy</span></span><a class="reference internal" href="_modules/distance_estimation.html#ClearingStrategy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#distance_estimation.ClearingStrategy" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#distance_estimation.TableAnalysisStrategy" title="distance_estimation.TableAnalysisStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">TableAnalysisStrategy</span></code></a></p>
<p>Simple clearing heuristic.</p>
<section id="heuristic">
<h2>Heuristic<a class="headerlink" href="#heuristic" title="Link to this heading"></a></h2>
<p>If <em>both</em> <code class="docutils literal notranslate"><span class="pre">'plate'</span></code> <strong>and</strong> <code class="docutils literal notranslate"><span class="pre">'cup'</span></code> appear in the detection list the
table is presumed finished → return <code class="docutils literal notranslate"><span class="pre">&quot;CLEAR&quot;</span></code>.  Any other combination
yields <code class="docutils literal notranslate"><span class="pre">&quot;IGNORE&quot;</span></code>.</p>
<dl class="py method">
<dt class="sig sig-object py" id="distance_estimation.ClearingStrategy.analyze">
<span class="sig-name descname"><span class="pre">analyze</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objects</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distance_estimation.html#ClearingStrategy.analyze"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#distance_estimation.ClearingStrategy.analyze" title="Link to this definition"></a></dt>
<dd><p>Decide what to do given the current object list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>objects</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>]</em>) – Detected class names, lowercase.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>One of the four keywords defined above.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)">str</a></p>
</dd>
</dl>
</dd></dl>

</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="distance_estimation.DistanceEstimator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">distance_estimation.</span></span><span class="sig-name descname"><span class="pre">DistanceEstimator</span></span><a class="reference internal" href="_modules/distance_estimation.html#DistanceEstimator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#distance_estimation.DistanceEstimator" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Combines perception and reasoning in one ROS node.</p>
<section id="life-cycle">
<h2>Life-cycle<a class="headerlink" href="#life-cycle" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>__init__</strong> – set up pubs/subs, allocate strategy objects.</p></li>
<li><p><strong>detection_callback</strong> / <strong>depth_callback</strong> – store latest data and call
<a class="reference internal" href="#distance_estimation.DistanceEstimator.try_estimate_positions" title="distance_estimation.DistanceEstimator.try_estimate_positions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">try_estimate_positions()</span></code></a>.</p></li>
<li><dl class="simple">
<dt><strong>try_estimate_positions</strong> – when <em>both</em> modalities are present:</dt><dd><ol class="arabic simple">
<li><p>Parse detection string → list.</p></li>
<li><p>For each class name, pick a proxy pixel (centre for now), read its
depth, back-project to XYZ using pinhole equation.</p></li>
<li><p>Publish formatted XYZ list.</p></li>
<li><p>Run both strategies, merge their keywords, publish.</p></li>
<li><p>Clear stored detections to avoid duplicate processing.</p></li>
</ol>
</dd>
</dl>
</li>
</ul>
<p>Public variables are intentionally <em>not</em> exposed; everything is internal
to the node.</p>
<dl class="py method">
<dt class="sig sig-object py" id="distance_estimation.DistanceEstimator.depth_callback">
<span class="sig-name descname"><span class="pre">depth_callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distance_estimation.html#DistanceEstimator.depth_callback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#distance_estimation.DistanceEstimator.depth_callback" title="Link to this definition"></a></dt>
<dd><p>Convert depth image to NumPy and attempt full pipeline.</p>
<p>Any conversion error is logged and ignored so the node keeps running.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="distance_estimation.DistanceEstimator.detection_callback">
<span class="sig-name descname"><span class="pre">detection_callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distance_estimation.html#DistanceEstimator.detection_callback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#distance_estimation.DistanceEstimator.detection_callback" title="Link to this definition"></a></dt>
<dd><p>Store latest detections and attempt full pipeline.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>msg</strong> (<em>std_msgs.String</em>) – Example payload: <code class="docutils literal notranslate"><span class="pre">&quot;Detected:</span> <span class="pre">cup,</span> <span class="pre">plate&quot;</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="distance_estimation.DistanceEstimator.parse_detections">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">parse_detections</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distance_estimation.html#DistanceEstimator.parse_detections"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#distance_estimation.DistanceEstimator.parse_detections" title="Link to this definition"></a></dt>
<dd><p>Turn <code class="docutils literal notranslate"><span class="pre">&quot;Detected:</span> <span class="pre">cup,</span> <span class="pre">plate&quot;</span></code> → <code class="docutils literal notranslate"><span class="pre">['cup',</span> <span class="pre">'plate']</span></code>.</p>
<p>Any parsing failure returns an <em>empty list</em> instead of throwing.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="distance_estimation.DistanceEstimator.project_to_robot_frame">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">project_to_robot_frame</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">u</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distance_estimation.html#DistanceEstimator.project_to_robot_frame"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#distance_estimation.DistanceEstimator.project_to_robot_frame" title="Link to this definition"></a></dt>
<dd><p>Pinhole back-projection from (u,v,depth) to metric XYZ.</p>
<p>Intrinsics here are <strong>example values</strong> for a 640×480 image; adjust to
your real camera.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>(x, y, z) in the camera coordinate frame.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a>[<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)">float</a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)">float</a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)">float</a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="distance_estimation.DistanceEstimator.try_estimate_positions">
<span class="sig-name descname"><span class="pre">try_estimate_positions</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/distance_estimation.html#DistanceEstimator.try_estimate_positions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#distance_estimation.DistanceEstimator.try_estimate_positions" title="Link to this definition"></a></dt>
<dd><p>Run localisation + reasoning once <em>both</em> modalities are present.</p>
<p>The method resets <code class="docutils literal notranslate"><span class="pre">self.latest_detections</span></code> afterwards so each detection
batch is processed exactly once, regardless of depth FPS.</p>
</dd></dl>

</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="distance_estimation.FindPlacementStrategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">distance_estimation.</span></span><span class="sig-name descname"><span class="pre">FindPlacementStrategy</span></span><a class="reference internal" href="_modules/distance_estimation.html#FindPlacementStrategy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#distance_estimation.FindPlacementStrategy" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#distance_estimation.TableAnalysisStrategy" title="distance_estimation.TableAnalysisStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">TableAnalysisStrategy</span></code></a></p>
<p><em>Minimal-viable</em> placement logic.</p>
<section id="id36">
<h2>Heuristic<a class="headerlink" href="#id36" title="Link to this heading"></a></h2>
<p>If the table currently hosts <strong>fewer than three</strong> detected objects, there
is space for another dish → return <code class="docutils literal notranslate"><span class="pre">&quot;PLACE&quot;</span></code>.  Otherwise return
<code class="docutils literal notranslate"><span class="pre">&quot;FULL&quot;</span></code>.</p>
<dl class="py method">
<dt class="sig sig-object py" id="distance_estimation.FindPlacementStrategy.analyze">
<span class="sig-name descname"><span class="pre">analyze</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objects</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distance_estimation.html#FindPlacementStrategy.analyze"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#distance_estimation.FindPlacementStrategy.analyze" title="Link to this definition"></a></dt>
<dd><p>Decide what to do given the current object list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>objects</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>]</em>) – Detected class names, lowercase.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>One of the four keywords defined above.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)">str</a></p>
</dd>
</dl>
</dd></dl>

</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="distance_estimation.TableAnalysisStrategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">distance_estimation.</span></span><span class="sig-name descname"><span class="pre">TableAnalysisStrategy</span></span><a class="reference internal" href="_modules/distance_estimation.html#TableAnalysisStrategy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#distance_estimation.TableAnalysisStrategy" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.ABC" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ABC</span></code></a></p>
<p>Abstract contract for any <em>table-state</em> decision algorithm.</p>
<p>Subclasses must override <a class="reference internal" href="#distance_estimation.TableAnalysisStrategy.analyze" title="distance_estimation.TableAnalysisStrategy.analyze"><code class="xref py py-meth docutils literal notranslate"><span class="pre">analyze()</span></code></a> and return <strong>one of four</strong>
canonical keywords:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;PLACE&quot;</span></code>  – safe to put another plate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;FULL&quot;</span></code>   – table already crowded; wait.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;CLEAR&quot;</span></code>  – fetch dirty items.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;IGNORE&quot;</span></code> – no action required.</p></li>
</ul>
</div></blockquote>
<section id="design-notes">
<h2>Design notes<a class="headerlink" href="#design-notes" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>The strategy receives a <strong>plain Python list</strong> of object class‐names to
keep the interface agnostic of the detector message format.</p></li>
<li><p>The caller combines multiple strategies (placement + clearing) if both
decisions are required.</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="distance_estimation.TableAnalysisStrategy.analyze">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">analyze</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objects</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/distance_estimation.html#TableAnalysisStrategy.analyze"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#distance_estimation.TableAnalysisStrategy.analyze" title="Link to this definition"></a></dt>
<dd><p>Decide what to do given the current object list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>objects</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>]</em>) – Detected class names, lowercase.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>One of the four keywords defined above.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)">str</a></p>
</dd>
</dl>
</dd></dl>

</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="distance_estimation.main">
<span class="sig-prename descclassname"><span class="pre">distance_estimation.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/distance_estimation.html#main"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#distance_estimation.main" title="Link to this definition"></a></dt>
<dd><p>Spin the node until ROS master shuts down.</p>
<p>Any non-ROS exception bubbles up with a full traceback for easier debugging.</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Assignment 1 Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="reasoning.html" class="btn btn-neutral float-right" title="Reasoning &amp; Planning Components" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Arian Tavousi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>